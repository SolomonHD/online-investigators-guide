<p id="notice"><%= notice %></p>
<%= render partial: "sideMenu" %>
  <section class="column page-body">
    <nav class="breadcrumb" aria-label="breadcrumbs">
      <ul>
        <% @page.ancestors.each do |page| %>
          <li><%= link_to page.title, page %></li>
        <% end %>
        <li class="is-active"><%= link_to @page.title, @page, 'aria-current'=>'page' %></li>
      </ul>
    </nav>

    <h1 class="title">
      <%= @page.header %>
    </h1>
    <div class="page-body">
      <%= raw @page.body %>

    <!--  IF PAGE IS ROOT, BUILD ONLY DIRECT DESCENDANTS -->
    <% if @page.is_root? %>
      <ol type="a">
        <% if params[:user] and params[:view] and current_user %>
          <% @page.descendants(:to_depth => 1).each do |child| %>
            <% if ! LabelsPage.where(:page_id => child.id).empty? %>
              <li>
                <%= link_to child.title, page_path(child, :user => params[:user], :view => params[:view]) %>
              </li>
            <% end %>
          <% end %>
        <% else %>
          <% @page.descendants(:to_depth => 1).each do |child| %>
            <li><%= link_to child.title, child %></li>
          <% end %>
        <% end %>
      </ol>
    <!--  ELSE DISPLAY ALL DIRECT DESCENDANTS -->
    <% else %>
      <!-- BUILD ANCHOR MENU -->
      <ol>
        <% @page.descendants.each do |child| %>
          <li>
            <%= link_to child.title, "#"+child.title.parameterize %>
          </li>
        <% end %>
      </ol>
      <!-- TRAVERSE DESCENDANTS AND CREATE PAGE -->
      <% @page.descendants.each_with_index do |child, index| %>
        <article>
          <a id="<%= child.title.parameterize %>">
            <h2 class="subtitle"><%= index + 1%>. <%= child.header %></h2>
          </a>
          <%= raw child.body %>
        </article>
      <% end %>
    <% end %>
    </div>
  </section>
